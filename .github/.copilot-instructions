# Copilot Instructions for Scalar

## Project Context
This is a 2D side-scrolling game built with Phaser 3 and Vite. The game features a controllable vehicle that moves across platforms with physics-based gravity and collision detection.

## Technology Stack
- **Framework**: Phaser 3.55.2
- **Language**: TypeScript
- **Build Tool**: Vite 5.x
- **Physics**: Arcade Physics (built into Phaser)
- **Architecture**: Modular with managers, systems, and scene-based organization

## Code Style Guidelines
- Use TypeScript with proper type annotations
- Add class property declarations for all instance variables
- Import Phaser explicitly: `import Phaser from 'phaser'`
- Use ES6+ syntax (arrow functions, const/let, destructuring)
- Follow Phaser 3 conventions for game scenes and lifecycle methods
- Keep functions concise and focused on single responsibilities
- Use descriptive variable names with types when beneficial
- Comment complex logic and game mechanics
- Prefer classes and modules over global functions

## Project Structure
```
src/
  main.ts                 - Application entry point
  config.ts               - Game configuration constants
  scenes/                 - Phaser scene classes
    BootScene.ts          - Asset loading
    MenuScene.ts          - Main menu and difficulty selection
    MainGameScene.ts      - Primary gameplay
    MicroScene.ts         - Cellular-level gameplay
  systems/                - Game logic systems
    CombatSystem.ts       - Combat and damage calculations
    PlayerStatsSystem.ts  - Player health, XP, leveling
    SpawnSystem.ts        - Enemy and XP orb spawning
    MagnetismSystem.ts    - XP orb attraction
  managers/               - Scene-specific managers
    InputManager.ts       - Keyboard input handling
    CollisionManager.ts   - Physics collision setup
    CameraManager.ts      - Camera following behavior
  ui/                     - UI components
    HUD.ts                - Health/XP bars, level display
    DebugDisplay.ts       - Debug information overlay
  utils/
    gameState.ts          - Centralized game state
index.html              - HTML entry point
style.css               - Game styling
vite.config.js          - Build configuration
tsconfig.json           - TypeScript configuration
```

## Common Patterns in This Project
- **TypeScript Classes**: All scenes extend `Phaser.Scene` with explicit Phaser import
- **Scene Lifecycle**: `preload()`, `create()`, `update()` methods
- **Modular Systems**: Separate systems for combat, stats, spawning, magnetism
- **Manager Pattern**: InputManager, CollisionManager, CameraManager per scene
- **Centralized State**: `gameState` singleton for shared state across scenes
- **Type Safety**: Property declarations on all classes, typed parameters where beneficial
- **Import Patterns**: No file extensions in imports (TypeScript standard)

## Development Workflow

### During Feature Development
1. Make changes to TypeScript files in `src/`
2. Test in development mode with `npm run dev`
3. Vite provides hot module reloading automatically
4. TypeScript errors are shown in terminal and browser console
5. Optional: Run `npx tsc --noEmit` to check types without building

### After Completing a Feature - QUALITY GATES
When a feature is complete, the following checks MUST pass before committing:
1. **Compilation Check**: Run `npm run build` to ensure the app compiles without errors
2. **Unit Tests**: Run any available test suites (if configured)
3. **Lint Rules**: Run linter to ensure code style compliance (if configured)
4. **Stage Changes**: Stage modified files with `git add`
5. **Draft Commit Message**: Create a clear, descriptive commit message following conventional commits format
6. **User Approval**: ALWAYS prompt the user for approval before executing `git commit`
   - Show the staged files
   - Show the proposed commit message
   - Wait for explicit user approval (yes/no)
   - Only proceed with `git commit` if user approves

### Git Commit Message Format
ALWAYS use verbose multi-line commit messages with separate -m flags for each line:
```bash
git commit -m "Primary summary line (50 chars max)" \
  -m "- First detailed point about changes" \
  -m "- Second detailed point" \
  -m "- Third point about implementation details" \
  -m "- Additional context or future implications"
```

**Format Requirements:**
- **First line**: Clear, concise summary (imperative mood: "Add feature" not "Added feature")
- **Subsequent lines**: Bullet points with detailed explanations using separate -m flags
- Include implementation details, affected systems, and future considerations
- Mention visual feedback, performance impacts, or architectural decisions

**Example:**
```bash
git commit -m "Add player-enemy collision system with bidirectional damage, knockback, and stun" \
  -m "- Player and enemies now collide physically (cannot pass through each other)" \
  -m "- Bidirectional damage: player deals 5 melee damage, enemy deals damage on contact" \
  -m "- Knockback mechanics: both entities pushed apart on collision" \
  -m "- 500ms stun after knockback prevents spam and creates hit-stop effect" \
  -m "- Configurable knockback resistance per enemy type" \
  -m "- Separate cooldowns for player->enemy (100ms) and enemy->player (500ms) damage" \
  -m "- Visual feedback: red flash for player, white flash for enemy, camera shake" \
  -m "- Future-ready for boss immunity and ability-based damage modifiers"
```

Types: `feat`, `fix`, `refactor`, `test`, `docs`, `chore`, `style`, `perf` (optional prefix)

## When Helping with Code
- **New Features**: Ask clarifying questions about game mechanics and user experience
- **Bug Fixes**: Identify whether issues are physics-related, input-related, or rendering-related
- **Refactoring**: Suggest improvements while maintaining Phaser 3 and TypeScript best practices
- **Performance**: Consider rendering efficiency and physics calculations
- **TypeScript**: Add type annotations to new functions, declare class properties, import Phaser where needed
- **Architecture**: Use appropriate system/manager for new features (e.g., combat goes in CombatSystem)

## Key Game Mechanics to Understand
- **Player Control**: Arrow keys for movement, spacebar for jumping
- **Gravity**: Y gravity is 300 pixels/secondÂ² (physics config)
- **Jumping**: Only possible when player is touching ground (`body.touching.down`)
- **Camera**: Follows player at all times, bounds set to 2048x768
- **Platforms**: Static physics objects that player collides with

## Planned Features (Future Consideration)
- Vehicle shrinking/growing mechanics
- Multiple platforms and obstacles
- Collectibles and scoring system
- Sound effects and visual effects
- Level progression

## Dependencies to Know
- **phaser**: Game framework with built-in physics, input, graphics (includes TypeScript definitions)
- **typescript**: Type checking and compilation
- **vite**: Development server and build tool with TypeScript support
- **@vitejs/plugin-basic-ssl**: HTTPS support during development

## Testing & Validation
- Test controls responsiveness during gameplay
- Verify collision detection works as expected
- Check camera bounds and world limits
- Ensure gravity behaves naturally
- Monitor performance with Phaser debug tools

## Common Issues & Solutions
- **Jump not working**: Verify `body.touching.down` state is true
- **Camera not following**: Check `startFollow()` is called on correct object
- **Platform collisions failing**: Ensure static group collision is set up
- **Performance issues**: Review physics body count and update loop complexity
